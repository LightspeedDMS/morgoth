// Test: Unfocused pane uses single-line border chars and dim colors
// Spec: Phase 14 - UI Refinement
// Priority: P14

≔ BOX_H  = "─";
≔ BOX_V  = "│";
≔ BOX_TL = "┌";
≔ BOX_TR = "┐";
≔ BOX_BL = "└";
≔ BOX_BR = "┘";
≔ BOX2_H  = "═";
≔ BOX2_V  = "║";
≔ BOX2_TL = "╔";
≔ BOX2_TR = "╗";
≔ BOX2_BL = "╚";
≔ BOX2_BR = "╝";

rite Cell_new(ch, fg, bg, dirty) {
    ↩ {ch: ch, fg: fg, bg: bg, dirty: dirty}
}

rite Grid_new(rows, cols) {
    ≔ total = rows * cols;
    ≔ mut cells = [];
    ≔ mut i = 0;
    ⟳ i < total {
        push(cells, Cell_new(" ", 7, 0, true));
        i = i + 1;
    }
    ↩ {rows: rows, cols: cols, cells: cells}
}

rite Grid_set(grid, row, col, ch, fg, bg) {
    ⎇ row >= 0 ∧ row < grid.rows ∧ col >= 0 ∧ col < grid.cols {
        ≔ idx = row * grid.cols + col;
        grid.cells[idx] = Cell_new(ch, fg, bg, true);
    }
}

rite Grid_get(grid, row, col) {
    ⎇ row >= 0 ∧ row < grid.rows ∧ col >= 0 ∧ col < grid.cols {
        ≔ idx = row * grid.cols + col;
        ↩ grid.cells[idx]
    }
    ↩ Cell_new(" ", 7, 0, false)
}

rite is_fullwidth(ch) { ↩ false }

rite render_border(grid, region, title, border_fg, title_fg, is_focused) {
    ≔ x = region.x;
    ≔ y = region.y;
    ≔ w = region.w;
    ≔ h = region.h;

    ≔ mut bh = BOX_H;
    ≔ mut bv = BOX_V;
    ≔ mut btl = BOX_TL;
    ≔ mut btr = BOX_TR;
    ≔ mut bbl = BOX_BL;
    ≔ mut bbr = BOX_BR;
    ⎇ is_focused == true {
        bh = BOX2_H;
        bv = BOX2_V;
        btl = BOX2_TL;
        btr = BOX2_TR;
        bbl = BOX2_BL;
        bbr = BOX2_BR;
    }

    Grid_set(grid, y, x, btl, border_fg, 0);
    ≔ mut c = 1;
    ⟳ c < w - 1 {
        Grid_set(grid, y, x + c, bh, border_fg, 0);
        c = c + 1;
    }
    Grid_set(grid, y, x + w - 1, btr, border_fg, 0);

    Grid_set(grid, y + h - 1, x, bbl, border_fg, 0);
    c = 1;
    ⟳ c < w - 1 {
        Grid_set(grid, y + h - 1, x + c, bh, border_fg, 0);
        c = c + 1;
    }
    Grid_set(grid, y + h - 1, x + w - 1, bbr, border_fg, 0);

    ≔ mut r = 1;
    ⟳ r < h - 1 {
        Grid_set(grid, y + r, x, bv, border_fg, 0);
        Grid_set(grid, y + r, x + w - 1, bv, border_fg, 0);
        r = r + 1;
    }

    ⎇ title != "" {
        ≔ max_title_cols = w - 4;
        ⎇ max_title_cols > 0 {
            ≔ mut ti = 0;
            ≔ mut tw = 0;
            ⟳ ti < len(title) ∧ tw < max_title_cols {
                Grid_set(grid, y, x + 2 + tw, to_string(char_at(title, ti)), title_fg, 0);
                tw = tw + 1;
                ti = ti + 1;
            }
        }
    }
}

rite main() {
    ≔ grid = Grid_new(8, 20);
    ≔ region = {x: 0, y: 0, w: 20, h: 8};

    // Render unfocused terminal border (dark gray=8, gray title=8, single-line)
    render_border(grid, region, "2:bash", 8, 8, false);

    // Test 1: Top-left corner is single-line
    ≔ tl = Grid_get(grid, 0, 0);
    ⎇ tl.ch == BOX_TL {
        println("unfocused_tl_single: OK");
    } ⎉ {
        println("unfocused_tl_single: FAILED ch=" + tl.ch);
    }

    // Test 2: Bottom-right corner is single-line
    ≔ br = Grid_get(grid, 7, 19);
    ⎇ br.ch == BOX_BR {
        println("unfocused_br_single: OK");
    } ⎉ {
        println("unfocused_br_single: FAILED ch=" + br.ch);
    }

    // Test 3: Horizontal edge is single-line (col 10, past the title)
    ≔ h_cell = Grid_get(grid, 0, 10);
    ⎇ h_cell.ch == BOX_H {
        println("unfocused_h_single: OK");
    } ⎉ {
        println("unfocused_h_single: FAILED ch=" + h_cell.ch);
    }

    // Test 4: Vertical edge is single-line
    ≔ v_cell = Grid_get(grid, 3, 0);
    ⎇ v_cell.ch == BOX_V {
        println("unfocused_v_single: OK");
    } ⎉ {
        println("unfocused_v_single: FAILED ch=" + v_cell.ch);
    }

    // Test 5: Border fg is dark gray (8)
    ⎇ tl.fg == 8 ∧ h_cell.fg == 8 ∧ v_cell.fg == 8 {
        println("unfocused_border_fg: OK");
    } ⎉ {
        println("unfocused_border_fg: FAILED tl=" + to_string(tl.fg) + " h=" + to_string(h_cell.fg) + " v=" + to_string(v_cell.fg));
    }

    // Test 6: Title fg is dark gray (8)
    ≔ t_cell = Grid_get(grid, 0, 2);
    ⎇ t_cell.fg == 8 {
        println("unfocused_title_fg: OK");
    } ⎉ {
        println("unfocused_title_fg: FAILED fg=" + to_string(t_cell.fg));
    }
}
